{"ast":null,"code":"import { generateCSSRule, generateCSSSupportRule, getRuleScore } from 'fela-utils';\nexport default function insertRule(_ref, renderer, node) {\n  var selector = _ref.selector,\n      declaration = _ref.declaration,\n      support = _ref.support,\n      media = _ref.media,\n      pseudo = _ref.pseudo;\n  var nodeReference = media + support;\n\n  try {\n    var score = getRuleScore(renderer.ruleOrder, pseudo);\n    var cssRules = node.sheet.cssRules;\n    var index = cssRules.length; // This heavily optimises the amount of rule iterations we need\n    // due to most rules having a score=0 anyways\n\n    if (score === 0) {\n      if (renderer.scoreIndex[nodeReference] === undefined) {\n        index = 0;\n      } else {\n        index = renderer.scoreIndex[nodeReference] + 1;\n      }\n    } else {\n      // we start iterating from the last score=0 entry\n      // to correctly inject pseudo classes etc.\n      var startIndex = renderer.scoreIndex[nodeReference] || 0;\n\n      for (var i = startIndex, len = cssRules.length; i < len; ++i) {\n        if (cssRules[i].score > score) {\n          index = i;\n          break;\n        }\n      }\n    }\n\n    var cssRule = generateCSSRule(selector, declaration);\n\n    if (support.length > 0) {\n      var cssSupportRule = generateCSSSupportRule(support, cssRule);\n      node.sheet.insertRule(cssSupportRule, index);\n    } else {\n      node.sheet.insertRule(cssRule, index);\n    }\n\n    if (score === 0) {\n      renderer.scoreIndex[nodeReference] = index;\n    }\n\n    cssRules[index].score = score;\n  } catch (e) {// We're disabled these warnings due to false-positive errors with browser prefixes\n    // See https://github.com/robinweser/fela/issues/634\n    // console.warn(\n    //   `An error occurred while inserting the rules into DOM.\\n`,\n    //   declaration.replace(/;/g, ';\\n'),\n    //   e\n    // )\n  }\n}","map":{"version":3,"names":["generateCSSRule","generateCSSSupportRule","getRuleScore","insertRule","_ref","renderer","node","selector","declaration","support","media","pseudo","nodeReference","score","ruleOrder","cssRules","sheet","index","length","scoreIndex","undefined","startIndex","i","len","cssRule","cssSupportRule","e"],"sources":["/Users/hoodboy/Documents/htdocs/TypescriptTextEditor2/node_modules/fela-dom/es/dom/connection/insertRule.js"],"sourcesContent":["import { generateCSSRule, generateCSSSupportRule, getRuleScore } from 'fela-utils';\n\nexport default function insertRule(_ref, renderer, node) {\n  var selector = _ref.selector,\n      declaration = _ref.declaration,\n      support = _ref.support,\n      media = _ref.media,\n      pseudo = _ref.pseudo;\n\n  var nodeReference = media + support;\n\n  try {\n    var score = getRuleScore(renderer.ruleOrder, pseudo);\n    var cssRules = node.sheet.cssRules;\n\n\n    var index = cssRules.length;\n\n    // This heavily optimises the amount of rule iterations we need\n    // due to most rules having a score=0 anyways\n    if (score === 0) {\n      if (renderer.scoreIndex[nodeReference] === undefined) {\n        index = 0;\n      } else {\n        index = renderer.scoreIndex[nodeReference] + 1;\n      }\n    } else {\n      // we start iterating from the last score=0 entry\n      // to correctly inject pseudo classes etc.\n      var startIndex = renderer.scoreIndex[nodeReference] || 0;\n\n      for (var i = startIndex, len = cssRules.length; i < len; ++i) {\n        if (cssRules[i].score > score) {\n          index = i;\n          break;\n        }\n      }\n    }\n\n    var cssRule = generateCSSRule(selector, declaration);\n\n    if (support.length > 0) {\n      var cssSupportRule = generateCSSSupportRule(support, cssRule);\n      node.sheet.insertRule(cssSupportRule, index);\n    } else {\n      node.sheet.insertRule(cssRule, index);\n    }\n\n    if (score === 0) {\n      renderer.scoreIndex[nodeReference] = index;\n    }\n\n    cssRules[index].score = score;\n  } catch (e) {\n    // We're disabled these warnings due to false-positive errors with browser prefixes\n    // See https://github.com/robinweser/fela/issues/634\n    // console.warn(\n    //   `An error occurred while inserting the rules into DOM.\\n`,\n    //   declaration.replace(/;/g, ';\\n'),\n    //   e\n    // )\n  }\n}"],"mappings":"AAAA,SAASA,eAAT,EAA0BC,sBAA1B,EAAkDC,YAAlD,QAAsE,YAAtE;AAEA,eAAe,SAASC,UAAT,CAAoBC,IAApB,EAA0BC,QAA1B,EAAoCC,IAApC,EAA0C;EACvD,IAAIC,QAAQ,GAAGH,IAAI,CAACG,QAApB;EAAA,IACIC,WAAW,GAAGJ,IAAI,CAACI,WADvB;EAAA,IAEIC,OAAO,GAAGL,IAAI,CAACK,OAFnB;EAAA,IAGIC,KAAK,GAAGN,IAAI,CAACM,KAHjB;EAAA,IAIIC,MAAM,GAAGP,IAAI,CAACO,MAJlB;EAMA,IAAIC,aAAa,GAAGF,KAAK,GAAGD,OAA5B;;EAEA,IAAI;IACF,IAAII,KAAK,GAAGX,YAAY,CAACG,QAAQ,CAACS,SAAV,EAAqBH,MAArB,CAAxB;IACA,IAAII,QAAQ,GAAGT,IAAI,CAACU,KAAL,CAAWD,QAA1B;IAGA,IAAIE,KAAK,GAAGF,QAAQ,CAACG,MAArB,CALE,CAOF;IACA;;IACA,IAAIL,KAAK,KAAK,CAAd,EAAiB;MACf,IAAIR,QAAQ,CAACc,UAAT,CAAoBP,aAApB,MAAuCQ,SAA3C,EAAsD;QACpDH,KAAK,GAAG,CAAR;MACD,CAFD,MAEO;QACLA,KAAK,GAAGZ,QAAQ,CAACc,UAAT,CAAoBP,aAApB,IAAqC,CAA7C;MACD;IACF,CAND,MAMO;MACL;MACA;MACA,IAAIS,UAAU,GAAGhB,QAAQ,CAACc,UAAT,CAAoBP,aAApB,KAAsC,CAAvD;;MAEA,KAAK,IAAIU,CAAC,GAAGD,UAAR,EAAoBE,GAAG,GAAGR,QAAQ,CAACG,MAAxC,EAAgDI,CAAC,GAAGC,GAApD,EAAyD,EAAED,CAA3D,EAA8D;QAC5D,IAAIP,QAAQ,CAACO,CAAD,CAAR,CAAYT,KAAZ,GAAoBA,KAAxB,EAA+B;UAC7BI,KAAK,GAAGK,CAAR;UACA;QACD;MACF;IACF;;IAED,IAAIE,OAAO,GAAGxB,eAAe,CAACO,QAAD,EAAWC,WAAX,CAA7B;;IAEA,IAAIC,OAAO,CAACS,MAAR,GAAiB,CAArB,EAAwB;MACtB,IAAIO,cAAc,GAAGxB,sBAAsB,CAACQ,OAAD,EAAUe,OAAV,CAA3C;MACAlB,IAAI,CAACU,KAAL,CAAWb,UAAX,CAAsBsB,cAAtB,EAAsCR,KAAtC;IACD,CAHD,MAGO;MACLX,IAAI,CAACU,KAAL,CAAWb,UAAX,CAAsBqB,OAAtB,EAA+BP,KAA/B;IACD;;IAED,IAAIJ,KAAK,KAAK,CAAd,EAAiB;MACfR,QAAQ,CAACc,UAAT,CAAoBP,aAApB,IAAqCK,KAArC;IACD;;IAEDF,QAAQ,CAACE,KAAD,CAAR,CAAgBJ,KAAhB,GAAwBA,KAAxB;EACD,CA1CD,CA0CE,OAAOa,CAAP,EAAU,CACV;IACA;IACA;IACA;IACA;IACA;IACA;EACD;AACF"},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _slicedToArray from \"/Users/hoodboy/Documents/htdocs/TypescriptTextEditor/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\n\nvar _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport { useEffect, useRef } from \"react\";\nimport { Editor, Range } from \"slate\";\nimport { ReactEditor } from \"slate-react\";\nimport { insertMention } from \"./utils\";\nexport var useMatchMention = function useMatchMention(_ref) {\n  _s();\n\n  var editor = _ref.editor,\n      setSearch = _ref.setSearch,\n      setTarget = _ref.setTarget;\n  useEffect(function () {\n    var selection = editor.selection;\n\n    if (selection && Range.isCollapsed(selection)) {\n      var _Range$edges = Range.edges(selection),\n          _Range$edges2 = _slicedToArray(_Range$edges, 1),\n          start = _Range$edges2[0];\n\n      var wordBefore = Editor.before(editor, start, {\n        unit: \"word\"\n      });\n      var before = wordBefore && Editor.before(editor, wordBefore);\n      var beforeRange = before && Editor.range(editor, before, start);\n      var beforeText = beforeRange && Editor.string(editor, beforeRange);\n      var beforeMatch = beforeText && beforeText.match(/^@(\\w+)$/);\n      var after = Editor.after(editor, start);\n      var afterRange = Editor.range(editor, start, after);\n      var afterText = Editor.string(editor, afterRange);\n      var afterMatch = afterText.match(/^(\\s|$)/);\n\n      if (beforeMatch && afterMatch) {\n        setTarget(beforeRange);\n        setSearch(beforeMatch[1]);\n        return;\n      }\n    }\n\n    setTarget(null);\n  });\n};\n\n_s(useMatchMention, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\nexport var useNavigateMention = function useNavigateMention(_ref2) {\n  _s2();\n\n  var editor = _ref2.editor,\n      index = _ref2.index,\n      suggestions = _ref2.suggestions,\n      target = _ref2.target,\n      setIndex = _ref2.setIndex,\n      setTarget = _ref2.setTarget;\n  useEffect(function () {\n    var handleNavigateMention = function handleNavigateMention(event) {\n      if (target) {\n        switch (event.key) {\n          case \"ArrowDown\":\n            event.preventDefault();\n            var prevIndex = index >= suggestions.length - 1 ? 0 : index + 1;\n            setIndex(prevIndex);\n            break;\n\n          case \"ArrowUp\":\n            event.preventDefault();\n            var nextIndex = index <= 0 ? suggestions.length - 1 : index - 1;\n            setIndex(nextIndex);\n            break;\n\n          case \"Tab\":\n          case \"Enter\":\n            {\n              event.preventDefault();\n              var entity = {\n                id: suggestions[index],\n                type: \"user\"\n              }; // TODO: derive from upstream\n\n              insertMention(editor, target, suggestions[index], entity);\n              setIndex(0);\n              setTarget(null);\n              break;\n            }\n\n          case \"Escape\":\n            event.preventDefault();\n            setIndex(0);\n            setTarget(null);\n            break;\n        }\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleNavigateMention);\n    return function () {\n      document.removeEventListener(\"keydown\", handleNavigateMention);\n    };\n  }, [editor, index, suggestions, target, setIndex, setTarget]);\n};\n\n_s2(useNavigateMention, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\nexport var usePopover = function usePopover(_ref3) {\n  _s3();\n\n  var count = _ref3.count,\n      editor = _ref3.editor,\n      index = _ref3.index,\n      search = _ref3.search,\n      target = _ref3.target;\n  var popoverRef = useRef(null);\n  useEffect(function () {\n    if (target && count > 0) {\n      var element = popoverRef.current;\n\n      if (element) {\n        var domRange = ReactEditor.toDOMRange(editor, target);\n        var rect = domRange.getBoundingClientRect();\n        element.style.top = \"\".concat(rect.top + window.pageYOffset + 24, \"px\");\n        element.style.left = \"\".concat(rect.left + window.pageXOffset, \"px\");\n      }\n    }\n  }, [count, editor, index, popoverRef, search, target]);\n  return popoverRef;\n};\n\n_s3(usePopover, \"f4nqSysZxLBLyh3V2W1niKpyCt0=\");","map":{"version":3,"names":["useEffect","useRef","Editor","Range","ReactEditor","insertMention","useMatchMention","editor","setSearch","setTarget","selection","isCollapsed","edges","start","wordBefore","before","unit","beforeRange","range","beforeText","string","beforeMatch","match","after","afterRange","afterText","afterMatch","useNavigateMention","index","suggestions","target","setIndex","handleNavigateMention","event","key","preventDefault","prevIndex","length","nextIndex","entity","id","type","document","addEventListener","removeEventListener","usePopover","count","search","popoverRef","element","current","domRange","toDOMRange","rect","getBoundingClientRect","style","top","window","pageYOffset","left","pageXOffset"],"sources":["/Users/hoodboy/Documents/htdocs/TypescriptTextEditor/src/TextEditor/mention/hooks.ts"],"sourcesContent":["import { useEffect, useRef } from \"react\";\nimport { Editor, Range } from \"slate\";\nimport { ReactEditor } from \"slate-react\";\n\nimport { insertMention } from \"./utils\";\n\nexport const useMatchMention = ({ editor, setSearch, setTarget }) => {\n  useEffect(() => {\n    const { selection } = editor;\n\n    if (selection && Range.isCollapsed(selection)) {\n      const [start] = Range.edges(selection);\n      const wordBefore = Editor.before(editor, start, { unit: \"word\" });\n      const before = wordBefore && Editor.before(editor, wordBefore);\n      const beforeRange = before && Editor.range(editor, before, start);\n      const beforeText = beforeRange && Editor.string(editor, beforeRange);\n      const beforeMatch = beforeText && beforeText.match(/^@(\\w+)$/);\n      const after = Editor.after(editor, start);\n      const afterRange = Editor.range(editor, start, after);\n      const afterText = Editor.string(editor, afterRange);\n      const afterMatch = afterText.match(/^(\\s|$)/);\n\n      if (beforeMatch && afterMatch) {\n        setTarget(beforeRange);\n        setSearch(beforeMatch[1]);\n        return;\n      }\n    }\n    setTarget(null);\n  });\n};\n\nexport const useNavigateMention = ({\n  editor,\n  index,\n  suggestions,\n  target,\n  setIndex,\n  setTarget,\n}) => {\n  useEffect(() => {\n    const handleNavigateMention = (event) => {\n      if (target) {\n        switch (event.key) {\n          case \"ArrowDown\":\n            event.preventDefault();\n            const prevIndex = index >= suggestions.length - 1 ? 0 : index + 1;\n            setIndex(prevIndex);\n            break;\n          case \"ArrowUp\":\n            event.preventDefault();\n            const nextIndex = index <= 0 ? suggestions.length - 1 : index - 1;\n            setIndex(nextIndex);\n            break;\n          case \"Tab\":\n          case \"Enter\": {\n            event.preventDefault();\n            const entity = { id: suggestions[index], type: \"user\" }; // TODO: derive from upstream\n            insertMention(editor, target, suggestions[index], entity);\n            setIndex(0);\n            setTarget(null);\n            break;\n          }\n          case \"Escape\":\n            event.preventDefault();\n            setIndex(0);\n            setTarget(null);\n            break;\n        }\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleNavigateMention);\n\n    return () => {\n      document.removeEventListener(\"keydown\", handleNavigateMention);\n    };\n  }, [editor, index, suggestions, target, setIndex, setTarget]);\n};\n\nexport const usePopover = ({ count, editor, index, search, target }) => {\n  const popoverRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (target && count > 0) {\n      const element = popoverRef.current;\n      if (element) {\n        const domRange = ReactEditor.toDOMRange(editor, target);\n        const rect = domRange.getBoundingClientRect();\n        element.style.top = `${rect.top + window.pageYOffset + 24}px`;\n        element.style.left = `${rect.left + window.pageXOffset}px`;\n      }\n    }\n  }, [count, editor, index, popoverRef, search, target]);\n\n  return popoverRef;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import arrayEach from 'fast-loops/lib/arrayEach';\nimport { RULE_TYPE, KEYFRAME_TYPE, getRuleScore } from 'fela-utils';\nimport rehydrateSupportRules from './rehydration/rehydrateSupportRules';\nimport rehydrateRules from './rehydration/rehydrateRules';\nimport render from './render';\nimport rehydrateKeyframes from './rehydration/rehydrateKeyframes';\nvar CLASSNAME_REGEX = /[.][a-z0-9_-]*/gi; // TODO: static, font\n\nexport default function rehydrate(renderer) {\n  var targetDocument = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document;\n  render(renderer, targetDocument);\n  arrayEach(targetDocument.querySelectorAll('[data-fela-type]'), function (node) {\n    var rehydrationAttribute = node.getAttribute('data-fela-rehydration') || -1;\n    var rehydrationIndex = renderer.uniqueRuleIdentifier || parseInt(rehydrationAttribute, 10); // skip rehydration if no rehydration index is set\n    // this index is set to -1 if something blocks rehydration\n\n    if (rehydrationIndex !== -1) {\n      var type = node.getAttribute('data-fela-type') || '';\n      var media = node.getAttribute('media') || '';\n      var support = node.getAttribute('data-fela-support') || '';\n      var css = node.textContent;\n      renderer.uniqueRuleIdentifier = rehydrationIndex;\n      var reference = type + media + support;\n      renderer.nodes[reference] = node;\n\n      if (type === RULE_TYPE) {\n        if (support) {\n          rehydrateSupportRules(css, media, renderer.cache, renderer.specificityPrefix);\n        } else {\n          rehydrateRules(css, media, '', renderer.cache, renderer.specificityPrefix);\n        } // On Safari, style sheets with IE-specific media queries\n        // can yield null for node.sheet\n        // https://github.com/robinweser/fela/issues/431#issuecomment-423239591\n\n\n        if (node.sheet && node.sheet.cssRules) {\n          var nodeReference = media + support;\n          arrayEach(node.sheet.cssRules, function (rule, index) {\n            var selectorText = rule.conditionText ? rule.cssRules[0].selectorText : rule.selectorText;\n            var score = getRuleScore(renderer.ruleOrder, selectorText.split(CLASSNAME_REGEX)[1]);\n\n            if (score === 0) {\n              renderer.scoreIndex[nodeReference] = index;\n            }\n\n            rule.score = score;\n          });\n        }\n      } else if (type === KEYFRAME_TYPE) {\n        rehydrateKeyframes(css, renderer.cache);\n      }\n    }\n  });\n}","map":{"version":3,"names":["arrayEach","RULE_TYPE","KEYFRAME_TYPE","getRuleScore","rehydrateSupportRules","rehydrateRules","render","rehydrateKeyframes","CLASSNAME_REGEX","rehydrate","renderer","targetDocument","arguments","length","undefined","document","querySelectorAll","node","rehydrationAttribute","getAttribute","rehydrationIndex","uniqueRuleIdentifier","parseInt","type","media","support","css","textContent","reference","nodes","cache","specificityPrefix","sheet","cssRules","nodeReference","rule","index","selectorText","conditionText","score","ruleOrder","split","scoreIndex"],"sources":["/Users/hoodboy/Documents/htdocs/TypescriptTextEditor/node_modules/fela-dom/es/dom/rehydrate.js"],"sourcesContent":["import arrayEach from 'fast-loops/lib/arrayEach';\nimport { RULE_TYPE, KEYFRAME_TYPE, getRuleScore } from 'fela-utils';\n\nimport rehydrateSupportRules from './rehydration/rehydrateSupportRules';\nimport rehydrateRules from './rehydration/rehydrateRules';\n\nimport render from './render';\n\nimport rehydrateKeyframes from './rehydration/rehydrateKeyframes';\n\nvar CLASSNAME_REGEX = /[.][a-z0-9_-]*/gi;\n\n// TODO: static, font\nexport default function rehydrate(renderer) {\n  var targetDocument = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document;\n\n  render(renderer, targetDocument);\n\n  arrayEach(targetDocument.querySelectorAll('[data-fela-type]'), function (node) {\n    var rehydrationAttribute = node.getAttribute('data-fela-rehydration') || -1;\n    var rehydrationIndex = renderer.uniqueRuleIdentifier || parseInt(rehydrationAttribute, 10);\n\n    // skip rehydration if no rehydration index is set\n    // this index is set to -1 if something blocks rehydration\n    if (rehydrationIndex !== -1) {\n      var type = node.getAttribute('data-fela-type') || '';\n      var media = node.getAttribute('media') || '';\n      var support = node.getAttribute('data-fela-support') || '';\n      var css = node.textContent;\n\n      renderer.uniqueRuleIdentifier = rehydrationIndex;\n\n      var reference = type + media + support;\n      renderer.nodes[reference] = node;\n\n      if (type === RULE_TYPE) {\n        if (support) {\n          rehydrateSupportRules(css, media, renderer.cache, renderer.specificityPrefix);\n        } else {\n          rehydrateRules(css, media, '', renderer.cache, renderer.specificityPrefix);\n        }\n\n        // On Safari, style sheets with IE-specific media queries\n        // can yield null for node.sheet\n        // https://github.com/robinweser/fela/issues/431#issuecomment-423239591\n        if (node.sheet && node.sheet.cssRules) {\n          var nodeReference = media + support;\n\n          arrayEach(node.sheet.cssRules, function (rule, index) {\n            var selectorText = rule.conditionText ? rule.cssRules[0].selectorText : rule.selectorText;\n\n            var score = getRuleScore(renderer.ruleOrder, selectorText.split(CLASSNAME_REGEX)[1]);\n\n            if (score === 0) {\n              renderer.scoreIndex[nodeReference] = index;\n            }\n\n            rule.score = score;\n          });\n        }\n      } else if (type === KEYFRAME_TYPE) {\n        rehydrateKeyframes(css, renderer.cache);\n      }\n    }\n  });\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}